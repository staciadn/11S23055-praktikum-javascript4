<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aplikasi Todo List</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="assets/vendor/bootstrap-5.3.7/package/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="assets/vendor/bootstrap-icons-1.13.1/package/font/bootstrap-icons.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="py-4 text-center text-white header-gradient">
      <h1 class="fw-bold">
        <i class="bi bi-check2-square"></i> Aplikasi Todo List
      </h1>
      <p class="mb-0">Atur kegiatanmu dengan mudah & menyenangkan ✨</p>
    </header>

    <main class="container py-4">
      <!-- Statistik -->
      <div class="row g-3 mb-4 text-center">
        <div class="col-md-6">
          <div class="card stat-card border-success">
            <div class="card-body">
              <h6 class="text-success fw-bold">
                <i class="bi bi-check-circle"></i> Selesai
              </h6>
              <h2 id="completedCount">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card stat-card border-warning">
            <div class="card-body">
              <h6 class="text-warning fw-bold">
                <i class="bi bi-hourglass-split"></i> Belum Selesai
              </h6>
              <h2 id="incompleteCount">0</h2>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Tambah Todo -->
      <form id="formData" class="mb-3 d-flex gap-2">
        <input
          type="text"
          class="form-control"
          name="todo"
          placeholder="Apa rencana kamu selanjutnya?"
        />
        <button class="btn btn-pink" type="submit">
          <i class="bi bi-plus-lg"></i> Tambah
        </button>
      </form>
      <div id="errorMsg" class="form-text text-danger mb-3"></div>

      <!-- Filter & Search -->
      <div class="card p-3 mb-4 shadow-sm">
        <div class="row g-2">
          <div class="col-md-4">
            <select id="filterSelect" class="form-select">
              <option value="all">Semua</option>
              <option value="completed">Selesai</option>
              <option value="incomplete">Belum Selesai</option>
            </select>
          </div>
          <div class="col-md-8">
            <input
              type="text"
              id="searchInput"
              class="form-control"
              placeholder="Cari todo..."
            />
          </div>
        </div>
      </div>

      <!-- Todo List -->
      <ul class="list-group shadow-sm" id="todoList"></ul>
    </main>

    <!-- Footer -->
    <footer class="footer text-center py-3">
      <small> © 2025 Aplikasi Todo List | dibuat oleh stacia ⋆˚꩜｡</small>
    </footer>

    <!-- Bootstrap JS -->
    <script src="assets/vendor/bootstrap-5.3.7/package/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <!-- Script Todo -->
    <script>
      let todos = JSON.parse(localStorage.getItem("todos")) || [];
      let filter = "all";
      let searchQuery = "";

      function renderTodos() {
        const todoList = document.getElementById("todoList");
        const completedCount = document.getElementById("completedCount");
        const incompleteCount = document.getElementById("incompleteCount");
        todoList.innerHTML = "";

        let filteredTodos = todos.filter((item) => {
          if (filter === "completed" && !item.completed) return false;
          if (filter === "incomplete" && item.completed) return false;
          if (searchQuery && !item.todo.toLowerCase().includes(searchQuery))
            return false;
          return true;
        });

        let completed = todos.filter((t) => t.completed).length;
        let incomplete = todos.length - completed;
        completedCount.textContent = completed;
        incompleteCount.textContent = incomplete;

        filteredTodos.forEach((item, index) => {
          const li = document.createElement("li");
          li.className =
            "list-group-item d-flex justify-content-between align-items-center todo-item";
          li.dataset.index = index;

          const leftDiv = document.createElement("div");
          leftDiv.className = "form-check flex-fill";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "form-check-input me-2";
          checkbox.checked = item.completed;
          checkbox.addEventListener("change", () => {
            item.completed = checkbox.checked;
            saveTodos();
            renderTodos();
          });

          const textWrapper = document.createElement("div");

          const label = document.createElement("label");
          label.className = "form-check-label fw-semibold";
          label.style.textDecoration = item.completed ? "line-through" : "none";
          label.textContent = item.todo;

          const small = document.createElement("small");
          small.className = "text-muted d-block";
          small.textContent = `Ditambahkan: ${item.createdAt}`;

          textWrapper.appendChild(label);
          textWrapper.appendChild(small);

          leftDiv.appendChild(checkbox);
          leftDiv.appendChild(textWrapper);

          const btnGroup = document.createElement("div");

          const editBtn = document.createElement("button");
          editBtn.className = "btn btn-sm btn-outline-purple me-1";
          editBtn.innerHTML = '<i class="bi bi-pencil"></i>';
          editBtn.addEventListener("click", () => {
            const newTodo = prompt("Edit todo:", item.todo);
            if (newTodo && newTodo.trim() !== "") {
              if (todos.some((t, i) => t.todo === newTodo && i !== index)) {
                alert("Todo sudah ada!");
                return;
              }
              item.todo = newTodo.trim();
              saveTodos();
              renderTodos();
            }
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-sm btn-outline-danger";
          deleteBtn.innerHTML = '<i class="bi bi-trash"></i>';
          deleteBtn.addEventListener("click", () => {
            todos.splice(index, 1);
            saveTodos();
            renderTodos();
          });

          btnGroup.appendChild(editBtn);
          btnGroup.appendChild(deleteBtn);

          li.appendChild(leftDiv);
          li.appendChild(btnGroup);
          todoList.appendChild(li);
        });

        Sortable.create(todoList, {
          animation: 150,
          onEnd: function (evt) {
            const movedItem = todos.splice(evt.oldIndex, 1)[0];
            todos.splice(evt.newIndex, 0, movedItem);
            saveTodos();
          },
        });
      }

      function saveTodos() {
        localStorage.setItem("todos", JSON.stringify(todos));
      }

      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("formData");
        const errorMsg = document.getElementById("errorMsg");
        const filterSelect = document.getElementById("filterSelect");
        const searchInput = document.getElementById("searchInput");

        form.addEventListener("submit", (event) => {
          event.preventDefault();
          const todoInput = form.todo.value.trim();

          if (!todoInput) {
            errorMsg.textContent = "Todo tidak boleh kosong!";
            return;
          }

          if (todos.some((t) => t.todo === todoInput)) {
            errorMsg.textContent = "Todo sudah ada!";
            return;
          }

          todos.unshift({
            todo: todoInput,
            completed: false,
            createdAt: new Date().toLocaleString("id-ID"),
          });
          form.todo.value = "";
          errorMsg.textContent = "";

          saveTodos();
          renderTodos();
        });

        filterSelect.addEventListener("change", () => {
          filter = filterSelect.value;
          renderTodos();
        });

        searchInput.addEventListener("input", () => {
          searchQuery = searchInput.value.trim().toLowerCase();
          renderTodos();
        });

        renderTodos();
      });
    </script>
  </body>
</html>
